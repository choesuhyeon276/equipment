const { initializeApp, cert } = require('firebase-admin/app');
const { getFirestore } = require('firebase-admin/firestore');
const path = require('path');

// ğŸ” ì¸ì¦: ë£¨íŠ¸ ê¸°ì¤€ì—ì„œ JSON ê²½ë¡œ ì •í™•íˆ ì§€ì •
const serviceAccount = require(path.join(__dirname, '../tools/serviceAccountKey.json'));

initializeApp({
  credential: cert(serviceAccount)
});

const db = getFirestore();

async function convertDescriptionsToNumber() {
  const collectionRef = db.collection('cameras');
  const snapshot = await collectionRef.get();

  let count = 0;

  for (const doc of snapshot.docs) {
    const data = doc.data();
    const desc = data.description;

    if (typeof desc === 'number') continue;

    const parsed = parseInt(desc);
    if (isNaN(parsed)) {
      console.warn(`âš ï¸ ë³€í™˜ ì‹¤íŒ¨: ${doc.id} - description: ${desc}`);
      continue;
    }

    await doc.ref.update({ description: parsed });
    console.log(`âœ… ${doc.id} updated â†’ ${parsed}`);
    count++;
  }

  console.log(`ğŸ‰ ì´ ${count}ê°œì˜ ë¬¸ì„œë¥¼ ì„±ê³µì ìœ¼ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤.`);
}

convertDescriptionsToNumber().catch(console.error);
